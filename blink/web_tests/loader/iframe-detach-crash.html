<!DOCTYPE html>
<body>
<script>
  if (window.testRunner) {
    testRunner.dumpAsText();
    testRunner.waitUntilDone();
  }

  let iframe = document.createElement("iframe");

  const mutationCallback = (mutationsList, observer) => {
    for (const mutation of mutationsList) {
      if (mutation.type === 'childList') {
        mutation.removedNodes.forEach(removedNode => {
          if (removedNode === iframe) {
            observer.disconnect();
            testRunner.notifyDone();
          }
        });
      }
    }
  };

  const observer = new MutationObserver(mutationCallback);
  observer.observe(document.body, {childList: true});

  iframe.srcdoc = `<!DOCTYPE html>
<meta http-equiv="Content-Security-Policy" content="require-trusted-types-for 'script';">
<script>
  window.addEventListener("load", _ => {
    trustedTypes.createPolicy("default", {
      createScript: s => {
        window.frameElement.remove();
        return s;
      }
    });
    window.location = 'javascript:;';
  });
<\/script>`;
  document.body.appendChild(iframe);
</script>
This test should not crash.
</body>